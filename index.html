<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈùúÈõªÁâ©ÁêÜÔºöÂâùÈõ¢ÊïàÊáâ (V = Q/C)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Roboto+Mono:wght@500&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .mono { font-family: 'Roboto Mono', monospace; }
        
        /* Custom slider */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
        
        /* Math Fraction Style */
        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            margin: 0 0.2em;
        }
        .fraction > span {
            display: block;
            padding: 0.1em;
        }
        .fraction span.numerator {
            border-bottom: 2px solid currentColor;
        }
        .fraction span.denominator {
            display: block;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-6xl overflow-hidden flex flex-col lg:flex-row">
        
        <!-- Controls & Physics Panel (Left Side) -->
        <div class="p-6 lg:w-1/3 bg-slate-50 border-r border-slate-200 flex flex-col gap-6">
            
            <div>
                <h1 class="text-2xl font-bold text-slate-800 mb-1">È†ÇÈáù/ÂâùÈõ¢ÊïàÊáâ (Pickup)</h1>
                <p class="text-sm text-slate-500">Áâ©ÁêÜÊú¨Ë≥™ÔºöÈõªËç∑ÂÆàÊÅÜÔºåË∑ùÈõ¢ÊãâÂ§ßÔºåÈõªÂ£ìÁàÜË°ù</p>
            </div>

            <!-- Formula Highlight Section -->
            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col items-center justify-center gap-4">
                
                <!-- Step 1: Basic V = Q/C -->
                <div class="flex items-center gap-3 text-2xl font-mono font-bold text-slate-700 w-full justify-center">
                    <!-- V Container (Fixed size to prevent jump) -->
                    <div class="w-12 h-12 flex items-center justify-center relative">
                         <span class="text-red-500 transition-all duration-100 absolute" id="eq-v" style="transform-origin: center;">V</span>
                    </div>
                    <span>=</span> 
                    <!-- Fraction Q/C -->
                    <div class="fraction">
                        <span class="numerator text-yellow-600 px-2">Q</span>
                        <span class="denominator text-blue-500 px-2 transition-all" id="eq-c">C</span>
                    </div>
                </div>

                <!-- Step 2: Substitution (The "Complete" Formula) -->
                <div class="w-full border-t border-slate-100 pt-3">
                    <div class="text-[10px] text-slate-400 text-center mb-1 font-sans">‰ª£ÂÖ• C = ŒµA / d</div>
                    <div class="flex items-center justify-center gap-2 text-lg font-mono font-bold text-slate-500">
                        <span>V</span>
                        <span>=</span>
                        <div class="fraction">
                            <span class="numerator text-yellow-600">Q</span>
                            <span class="denominator text-blue-400 text-sm">
                                ŒµA / <span class="text-slate-900 font-black transition-all bg-slate-100 px-1 rounded" id="eq-d">d</span>
                            </span>
                        </div>
                        <span class="text-slate-400">‚àù</span>
                        <span class="text-slate-800">d</span>
                        <span class="text-xs text-slate-400 ml-1">(Ê≠£ÊØî)</span>
                    </div>
                </div>
            </div>
            
            <!-- Meters -->
            <div class="space-y-6">
                <!-- Distance Control -->
                <div class="bg-slate-100 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-bold text-slate-700">È†ÇËµ∑È´òÂ∫¶ (Lift Height d)</label>
                        <span id="val-d" class="font-mono font-bold text-slate-900 bg-white px-2 py-0.5 rounded border border-slate-200">1.0 Œºm</span>
                    </div>
                    <input type="range" id="slider-d" min="1" max="100" value="1" step="0.5" oninput="updateSim()">
                    <div class="flex justify-between text-[11px] text-slate-500 mt-2 font-bold">
                        <span>Ë≤ºÂêà (Gap ~0)</span>
                        <span>ÂàÜÈõ¢ (Gap Large)</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <!-- Capacitance Meter -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 shadow-sm">
                        <div class="text-xs text-blue-600 font-bold uppercase mb-1 tracking-wider">ÈõªÂÆπ C</div>
                        <div class="font-mono text-xl font-black text-blue-800" id="val-c">1000 pF</div>
                        <div class="w-full bg-blue-200 h-2 rounded-full mt-3 overflow-hidden">
                            <div id="bar-c" class="bg-blue-500 h-full w-full"></div>
                        </div>
                    </div>

                    <!-- Voltage Meter -->
                    <div class="bg-red-50 p-4 rounded-lg border border-red-200 shadow-sm relative overflow-hidden transition-colors" id="meter-v">
                        <div class="text-xs text-red-600 font-bold uppercase mb-1 tracking-wider">Die Èõª‰Ωç V</div>
                        <div class="font-mono text-xl font-black text-red-800" id="val-v">10 V</div>
                        <div class="w-full bg-red-200 h-2 rounded-full mt-3 overflow-hidden">
                            <div id="bar-v" class="bg-red-500 h-full w-[1%] transition-all duration-100"></div>
                        </div>
                        <!-- Warning Icon -->
                        <div id="warn-icon" class="absolute top-2 right-2 text-red-600 opacity-0 transition-opacity">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Play Button -->
            <button id="play-btn" onclick="playAnimation()" class="mt-auto w-full py-4 bg-slate-800 hover:bg-slate-700 text-white font-bold text-lg rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 tracking-wide">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>
                ÊºîÁ§∫È†ÇËµ∑ÈÅéÁ®ã (Play)
            </button>

        </div>

        <!-- Visualization Panel (Right Side) -->
        <div class="p-0 lg:w-2/3 bg-slate-900 relative flex flex-col items-center justify-between overflow-hidden">
            
            <div class="absolute top-4 left-4 text-xs font-mono text-slate-400 opacity-50">
                Visualizing V = Q / C
            </div>

            <!-- Canvas Container -->
            <div class="relative w-full h-full flex items-center justify-center pt-10 pb-40">
                <canvas id="mainCanvas" width="800" height="500" class="w-full max-w-2xl h-auto object-contain"></canvas>
            </div>

            <!-- Graph Area Overlay -->
            <div class="absolute bottom-0 left-0 right-0 h-40 bg-slate-800/95 border-t border-slate-700 p-4 flex gap-6 shadow-[0_-5px_20px_rgba(0,0,0,0.3)]">
                <div class="flex-1 relative border border-slate-700/50 rounded bg-slate-900/50 p-2">
                    <canvas id="chartV"></canvas>
                </div>
                <div class="w-64 flex flex-col justify-center space-y-2 text-sm">
                    <div class="flex items-center gap-2 text-slate-300">
                        <span class="w-2 h-2 rounded-full bg-blue-400"></span>
                        <span>Die Ë¢´È†ÇËµ∑ÔºåÈõªÂÆπ‰∏ãÈôç (C‚Üì)</span>
                    </div>
                    <div class="flex items-center gap-2 text-slate-300">
                        <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
                        <span>Wafer ÈõªËç∑ÈéñÊ≠ª (Q Locked)</span>
                    </div>
                    <div class="flex items-center gap-2 text-red-400 font-bold bg-red-900/20 p-2 rounded border border-red-900/30">
                        <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                        <span>ÁµêÊûúÔºöDie Èõª‰ΩçÁû¨ÈñìÂçáÈ´ò (V‚Üë)</span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Physics Config
        const Q_FIXED = 100; // Arbitrary charge unit
        const BREAKDOWN_V = 2000; // Breakdown threshold
        
        // State
        let d = 1; // distance
        let isAnimating = false;
        
        // DOM
        const slider = document.getElementById('slider-d');
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const valD = document.getElementById('val-d');
        const valC = document.getElementById('val-c');
        const valV = document.getElementById('val-v');
        const barC = document.getElementById('bar-c');
        const barV = document.getElementById('bar-v');
        
        const eqV = document.getElementById('eq-v');
        const eqC = document.getElementById('eq-c');
        const eqD = document.getElementById('eq-d');
        
        const meterV = document.getElementById('meter-v');
        const warnIcon = document.getElementById('warn-icon');

        // Chart Setup
        const chartCtx = document.getElementById('chartV').getContext('2d');
        const chartV = new Chart(chartCtx, {
            type: 'line',
            data: {
                labels: Array(50).fill(''),
                datasets: [{
                    label: 'Die Voltage (V)',
                    data: Array(50).fill(null),
                    borderColor: '#f87171', // Red-400
                    borderWidth: 2,
                    tension: 0.4,
                    pointRadius: 0,
                    fill: 'start',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: {
                    x: { display: false },
                    y: { 
                        display: true,
                        suggestedMin: 0,
                        suggestedMax: 2500,
                        grid: { color: '#334155' },
                        ticks: { color: '#94a3b8', font: {family: "'Roboto Mono'"} }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });

        function updateSim() {
            d = parseFloat(slider.value);
            
            const C = 1000 / d;
            const V = d * 20; 

            // UI Updates
            valD.textContent = d < 10 ? d.toFixed(1) + " Œºm" : (d/10).toFixed(1) + " mm"; 
            valC.textContent = Math.round(C) + " pF";
            valV.textContent = Math.round(V) + " V";
            
            // Bars
            barC.style.width = Math.min(100, (C/1000)*100) + "%";
            barV.style.width = Math.min(100, (V/2000)*100) + "%";

            // Equation Animation
            const scaleV = 1 + (d/100)*1.0; 
            eqV.style.transform = `scale(${scaleV})`;
            
            eqC.style.opacity = Math.max(0.3, 1 - d/100);
            
            // Highlight 'd' in the second formula
            const weight = Math.min(900, 400 + d*5);
            eqD.style.fontWeight = weight;
            eqD.style.transform = `scale(${1 + d/200})`;

            // Warning State
            if (V > BREAKDOWN_V) {
                meterV.classList.add('bg-red-100', 'border-red-400', 'shadow-md');
                valV.classList.add('text-red-600');
                warnIcon.style.opacity = 1;
                warnIcon.classList.add('animate-bounce');
            } else {
                meterV.classList.remove('bg-red-100', 'border-red-400', 'shadow-md');
                valV.classList.remove('text-red-600');
                warnIcon.style.opacity = 0;
                warnIcon.classList.remove('animate-bounce');
            }

            // Update Chart
            const data = chartV.data.datasets[0].data;
            data.shift();
            data.push(V);
            chartV.update('none');

            drawCanvas(d, V);
        }

        function drawCanvas(dist, voltage) {
            // Setup High DPI Canvas
            const dpr = window.devicePixelRatio || 1;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const cx = canvas.width / 2;
            const cy = canvas.height;
            
            // Layout Coords
            const baseY = 400; // Lowered base to give room
            const plateW = 400; // Wider plates
            const plateH = 30; // Wafer thickness
            const dieH = 20;   // Die thickness
            
            // Visual mapping of d (1..100) to pixels (0..200)
            const liftY = dist * 2.5; 
            const topY = baseY - dieH - liftY; // Initial position on top of wafer

            // 1. Draw Wafer (Stationary Bottom)
            ctx.fillStyle = "#1e293b"; // Slate-800 Dark fill
            ctx.fillRect(cx - plateW/2, baseY, plateW, plateH);
            // Wafer Border
            ctx.strokeStyle = "#475569"; // Slate-600
            ctx.lineWidth = 2;
            ctx.strokeRect(cx - plateW/2, baseY, plateW, plateH);
            
            // Wafer Label
            ctx.fillStyle = "#94a3b8"; // Light Slate Text
            ctx.font = "bold 16px 'Noto Sans TC', sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("Wafer (Êô∂Âúì - GND/Floating)", cx, baseY + 60);

            // 2. Draw Die (Moving Top)
            ctx.fillStyle = "#e2e8f0"; // Slate-200 (Bright Silver/White)
            ctx.shadowColor = "rgba(0,0,0,0.5)";
            ctx.shadowBlur = 10;
            ctx.fillRect(cx - plateW/2, topY, plateW, dieH);
            ctx.shadowBlur = 0;
            
            // Die Label
            ctx.fillStyle = "#ffffff"; // White
            ctx.font = "bold 18px 'Noto Sans TC', sans-serif";
            ctx.fillText("Die (Êô∂Áâá/ÂÖÉ‰ª∂)", cx, topY - 15);
            
            // 3. Draw Charges (Q)
            // Use distinct colors for charges
            ctx.font = "bold 20px monospace";
            const chargeCount = 8;
            const spacing = plateW / (chargeCount + 1);
            
            for(let i=1; i<=chargeCount; i++) {
                const x = (cx - plateW/2) + i*spacing;
                
                // Top Plate Charges (+) - Induced on Die (Red)
                ctx.fillStyle = "#ef4444"; // Red-500
                ctx.fillText("+", x, topY + 18);
                
                // Bottom Plate Charges (-) - Fixed on Wafer (Yellow)
                ctx.fillStyle = "#facc15"; // Yellow-400
                ctx.fillText("-", x, baseY + 22); 
                
                // E-Field Lines (Fading as d increases)
                if (dist < 80 && !isSparking(voltage)) {
                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(255, 255, 255, ${0.3 - dist/300})`; // Faint white lines
                    ctx.setLineDash([4, 4]);
                    ctx.moveTo(x, topY + 22);
                    ctx.lineTo(x, baseY);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            }
            
            // 3.1 Draw "Q Locked" label on Wafer
            ctx.fillStyle = "#facc15"; // Yellow-400
            ctx.font = "bold 16px 'Roboto Mono', monospace";
            ctx.textAlign = "center";
            // Background box for text readability
            const qText = "üîí Q Locked";
            const qWidth = ctx.measureText(qText).width;
            ctx.fillStyle = "rgba(0,0,0,0.6)";
            ctx.fillRect(cx - qWidth/2 - 10, baseY + 10, qWidth + 20, 24);
            
            ctx.fillStyle = "#facc15"; // Yellow Text
            ctx.fillText(qText, cx, baseY + 27); 

            // 4. Draw Distance Arrow (White)
            const arrowX = cx + plateW/2 + 60;
            ctx.beginPath();
            ctx.strokeStyle = "#ffffff";
            ctx.lineWidth = 2;
            
            // Vertical Line
            ctx.moveTo(arrowX, topY + dieH/2);
            ctx.lineTo(arrowX, baseY); 
            
            // Tick marks
            ctx.moveTo(arrowX - 8, topY + dieH/2);
            ctx.lineTo(arrowX + 8, topY + dieH/2);
            ctx.moveTo(arrowX - 8, baseY);
            ctx.lineTo(arrowX + 8, baseY);
            ctx.stroke();

            // Label d
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 16px sans-serif";
            ctx.fillText("d", arrowX + 20, (topY + baseY)/2 + 5);

            // 6. Victim Component (GND Object)
            const victimX = cx - plateW/2 - 80;
            const pinY = baseY - 60; 
            
            drawVictim(victimX, pinY);
            
            // Check Arc
            if (isSparking(voltage)) {
                // Draw Spark from Die to Pin
                const startX = cx - plateW/2;
                const startY = topY + dieH/2;
                const endX = victimX + 10; 
                const endY = pinY;
                
                drawSpark(startX, startY, endX, endY);
                
                // Flash effect
                ctx.fillStyle = "rgba(255, 50, 50, 0.1)"; // Red flash
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = "#ef4444";
                ctx.font = "bold 24px 'Noto Sans TC', sans-serif";
                ctx.shadowColor = "black";
                ctx.shadowBlur = 10;
                ctx.textAlign = "center";
                ctx.fillText("‚ö° BREAKDOWN! ‚ö°", cx, 100);
                ctx.shadowBlur = 0;
            }
        }

        function drawVictim(x, y) {
            const h = 60;
            const w = 20;
            
            // Draw Victim Pin
            ctx.fillStyle = "#94a3b8"; // Slate-400
            ctx.fillRect(x, y, w, h);
            
            // Base
            ctx.fillStyle = "#475569"; // Darker Base
            ctx.fillRect(x - 10, y + h, w + 20, 10);

            // Label
            ctx.fillStyle = "#ffffff";
            ctx.font = "14px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("GND Obj", x + w/2, y + h + 25);
        }

        function isSparking(v) {
            return v > BREAKDOWN_V;
        }

        function drawSpark(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.strokeStyle = "#facc15"; // Yellow-400
            ctx.lineWidth = 5;
            ctx.lineCap = "round";
            ctx.shadowBlur = 20;
            ctx.shadowColor = "#fde047"; // Bright Yellow Glow
            
            ctx.moveTo(x1, y1);
            // Jagged line
            let currX = x1;
            let currY = y1;
            const steps = 12;
            const dx = (x2 - x1) / steps;
            const dy = (y2 - y1) / steps;
            
            for(let i=0; i<steps; i++) {
                currX += dx;
                currY += dy;
                const jit = (Math.random() - 0.5) * 30;
                ctx.lineTo(currX + jit, currY + jit);
            }
            ctx.lineTo(x2, y2);
            ctx.stroke();
            
            // Reset shadow
            ctx.shadowBlur = 0;
        }

        function playAnimation() {
            if(isAnimating) return;
            isAnimating = true;
            let currentVal = 1;
            
            const interval = setInterval(() => {
                currentVal += 1;
                if(currentVal > 100) {
                    clearInterval(interval);
                    isAnimating = false;
                }
                slider.value = currentVal;
                updateSim();
            }, 30);
        }

        // Init
        updateSim();

    </script>
</body>

</html>
